import { DataStoreConfigurationRepository } from "../../domain/autogenerated-forms-configurator/repositories/DataStoreConfigurationRepository";
import { D2Api } from "../../types/d2-api";
import { Namespaces } from "../common/clients/storage/Namespaces";
import { AutogenConfig } from "../../domain/autogenerated-forms-configurator/entities/AutogenConfig";

export class Dhis2DataStoreConfigurationRepository implements DataStoreConfigurationRepository {
    constructor(private api: D2Api) {}

    async getFormConfig(namespace: string): Promise<AutogenConfig> {
        return (
            (await this.api.dataStore(Namespaces.D2_AUTOGEN_FORMS).get<AutogenConfig>(namespace).getData()) ?? {
                categoryCombinations: {},
                dataElements: {},
                dataSets: {},
            }
        );
    }

    async saveFormConfig(namespace: string, config: AutogenConfig): Promise<void> {
        return await this.api.dataStore(Namespaces.D2_AUTOGEN_FORMS).save(namespace, config).getData();
    }
}
